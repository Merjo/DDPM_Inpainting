#######################################################################################
### conda added to PATH. Use 'source activate' rather than 'conda activate'.        ###
### Do not run 'conda init' if prompted.                                            ###
### 'conda init' will modify your shell outside of the `module` environment         ###
#######################################################################################
[I 2025-10-17 15:37:20,021] A new study created in RDB with name: rain_diffusion_1760708239
[I 2025-10-17 15:45:20,910] Trial 0 finished with value: 0.02805642777393325 and parameters: {'model_channels': 64, 'num_blocks': 3, 'dropout': 0.1562252975429974, 'downsample_type': 'residual', 'channel_mult': '1248', 'attn_config': 'none', 'timesteps': 500, 'beta_schedule': 'cosine', 'loss': 'l1', 'optimizer': 'Adam', 'scheduler': 'ExponentialLR', 'lr': 9.500108367808721e-05}. Best is trial 0 with value: 0.02805642777393325.
[I 2025-10-17 15:59:36,624] Trial 1 finished with value: 0.012666158725882467 and parameters: {'model_channels': 128, 'num_blocks': 3, 'dropout': 0.2878314679021161, 'downsample_type': 'standard', 'channel_mult': '1248', 'attn_config': 'last_two', 'timesteps': 1000, 'beta_schedule': 'linear', 'loss': 'l1', 'optimizer': 'Adam', 'scheduler': 'ExponentialLR', 'lr': 0.0003636404148810455}. Best is trial 1 with value: 0.012666158725882467.
[W 2025-10-17 16:11:22,630] Trial 2 failed with parameters: {'model_channels': 64, 'num_blocks': 3, 'dropout': 0.13810169703707031, 'downsample_type': 'residual', 'channel_mult': '1224', 'attn_config': 'last_two', 'timesteps': 500, 'beta_schedule': 'exponential', 'loss': 'mse', 'optimizer': 'AdamW', 'scheduler': 'WarmupCosine', 'lr': 1.1981179753663928e-05} because of the following error: TypeError("Diffusion.sample() got an unexpected keyword argument 'n'").
Traceback (most recent call last):
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 201, in _run_trial
    value_or_values = func(trial)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 139, in <lambda>
    study.optimize(lambda trial: objective(trial, loader=loader, run_dir=run_dir, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 100, in objective
    best_rmse, epoch_losses = diffusion.train(
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 182, in train
    samples = self.sample(n=128)  # shape: (n, c, h, w)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
TypeError: Diffusion.sample() got an unexpected keyword argument 'n'
[W 2025-10-17 16:11:22,657] Trial 2 failed with value None.
Traceback (most recent call last):
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_best_optuna.py", line 91, in <module>
    diffusion, unet, best_loss = run_best_optuna(n_trials=n_trials,
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_best_optuna.py", line 72, in run_best_optuna
    param_filename, model_filename = run_optuna(n_trials=n_trials, 
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 139, in run_optuna
    study.optimize(lambda trial: objective(trial, loader=loader, run_dir=run_dir, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/study.py", line 490, in optimize
    _optimize(
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 63, in _optimize
    _optimize_sequential(
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 160, in _optimize_sequential
    frozen_trial_id = _run_trial(study, func, catch)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 258, in _run_trial
    raise func_err
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 201, in _run_trial
    value_or_values = func(trial)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 139, in <lambda>
    study.optimize(lambda trial: objective(trial, loader=loader, run_dir=run_dir, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 100, in objective
    best_rmse, epoch_losses = diffusion.train(
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 182, in train
    samples = self.sample(n=128)  # shape: (n, c, h, w)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
TypeError: Diffusion.sample() got an unexpected keyword argument 'n'
