#######################################################################################
### conda added to PATH. Use 'source activate' rather than 'conda activate'.        ###
### Do not run 'conda init' if prompted.                                            ###
### 'conda init' will modify your shell outside of the `module` environment         ###
#######################################################################################
[I 2025-10-08 09:45:34,424] A new study created in memory with name: no-name-23aab144-58ca-49a6-ac63-a7a493755a48
[W 2025-10-08 09:45:41,077] Trial 0 failed with parameters: {'model_channels': 256, 'num_blocks': 2, 'dropout': 0.25331652518215086, 'downsample_type': 'standard', 'channel_mult': '124', 'attn_config': 'last', 'timesteps': 250, 'beta_schedule': 'quadratic', 'loss': 'huber', 'optimizer': 'Adam', 'scheduler': 'WarmupCosine', 'lr': 0.0004644122972099885} because of the following error: OutOfMemoryError('CUDA out of memory. Tried to allocate 128.00 MiB. GPU 0 has a total capacity of 79.20 GiB of which 5.38 MiB is free. Including non-PyTorch memory, this process has 79.19 GiB memory in use. Of the allocated memory 78.10 GiB is allocated by PyTorch, and 436.33 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)').
Traceback (most recent call last):
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 201, in _run_trial
    value_or_values = func(trial)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 117, in <lambda>
    study.optimize(lambda trial: objective(trial, loader=loader, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 99, in objective
    best_rmse, epoch_losses = diffusion.train(
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 122, in train
    loss = self.p_losses(imgs, t)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 76, in p_losses
    pred = self.model(xt, t)  # UNet predicts the noise
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/song/song_unet.py", line 207, in forward
    x = block(x, emb)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/song/song_helper_classes.py", line 300, in forward
    x = self.conv1(torch.nn.functional.dropout(x, p=self.dropout, training=self.training))
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/functional.py", line 1425, in dropout
    _VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 128.00 MiB. GPU 0 has a total capacity of 79.20 GiB of which 5.38 MiB is free. Including non-PyTorch memory, this process has 79.19 GiB memory in use. Of the allocated memory 78.10 GiB is allocated by PyTorch, and 436.33 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
[W 2025-10-08 09:45:41,081] Trial 0 failed with value None.
Traceback (most recent call last):
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_best_optuna.py", line 93, in <module>
    diffusion, unet, best_loss = run_best_optuna(n_trials=n_trials,
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_best_optuna.py", line 72, in run_best_optuna
    param_filename, model_filename = run_optuna(n_trials=n_trials, 
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 117, in run_optuna
    study.optimize(lambda trial: objective(trial, loader=loader, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/study.py", line 490, in optimize
    _optimize(
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 63, in _optimize
    _optimize_sequential(
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 160, in _optimize_sequential
    frozen_trial_id = _run_trial(study, func, catch)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 258, in _run_trial
    raise func_err
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 201, in _run_trial
    value_or_values = func(trial)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 117, in <lambda>
    study.optimize(lambda trial: objective(trial, loader=loader, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 99, in objective
    best_rmse, epoch_losses = diffusion.train(
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 122, in train
    loss = self.p_losses(imgs, t)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 76, in p_losses
    pred = self.model(xt, t)  # UNet predicts the noise
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/song/song_unet.py", line 207, in forward
    x = block(x, emb)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/song/song_helper_classes.py", line 300, in forward
    x = self.conv1(torch.nn.functional.dropout(x, p=self.dropout, training=self.training))
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/nn/functional.py", line 1425, in dropout
    _VF.dropout_(input, p, training) if inplace else _VF.dropout(input, p, training)
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 128.00 MiB. GPU 0 has a total capacity of 79.20 GiB of which 5.38 MiB is free. Including non-PyTorch memory, this process has 79.19 GiB memory in use. Of the allocated memory 78.10 GiB is allocated by PyTorch, and 436.33 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
