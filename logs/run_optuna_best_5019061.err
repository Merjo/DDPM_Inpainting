#######################################################################################
### conda added to PATH. Use 'source activate' rather than 'conda activate'.        ###
### Do not run 'conda init' if prompted.                                            ###
### 'conda init' will modify your shell outside of the `module` environment         ###
#######################################################################################
[I 2025-11-03 15:53:01,189] A new study created in RDB with name: rain_diffusion_1762181580
slurmstepd-csl14c243: error: _handle_stat_jobacct: Took usec=-483299, which is more than MessageTimeout (10s). The result won't be delivered
/home/merlinho/testspace/DDPM_Inpainting/src/save/save_plot.py:281: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout()
[W 2025-11-03 16:33:39,754] Trial 0 failed with parameters: {'dropout': 0.2655260180744361, 'optimizer': 'Adam', 'scheduler': 'WarmupCosine', 'lr': 0.0018043921769892823} because of the following error: ValueError('autodetected range of [nan, nan] is not finite').
Traceback (most recent call last):
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 201, in _run_trial
    value_or_values = func(trial)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 196, in <lambda>
    study.optimize(lambda trial: objective(trial, loader=loader, run_dir=run_dir, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 166, in objective
    best_loss = diffusion.train(
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 185, in train
    self.plot_histogram(loader=dataloader, epoch=last_epoch, sample_info=sample_info, samples=samples)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 218, in plot_histogram
    plot_histogram(real, generated, title, out_dir=self.hist_dir)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/save/save_plot.py", line 315, in plot_histogram
    bins_edges = np.histogram_bin_edges(combined, bins=bins)  # e.g., bins=50
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/numpy/lib/histograms.py", line 669, in histogram_bin_edges
    bin_edges, _ = _get_bin_edges(a, bins, range, weights)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/numpy/lib/histograms.py", line 426, in _get_bin_edges
    first_edge, last_edge = _get_outer_edges(a, range)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/numpy/lib/histograms.py", line 323, in _get_outer_edges
    raise ValueError(
ValueError: autodetected range of [nan, nan] is not finite
[W 2025-11-03 16:33:39,762] Trial 0 failed with value None.
Traceback (most recent call last):
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna_best.py", line 94, in <module>
    diffusion, unet, best_loss, params = run_optuna_best(n_trials=n_trials,
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna_best.py", line 74, in run_optuna_best
    param_filename, model_filename = run_optuna(n_trials=n_trials, 
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 196, in run_optuna
    study.optimize(lambda trial: objective(trial, loader=loader, run_dir=run_dir, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/study.py", line 490, in optimize
    _optimize(
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 63, in _optimize
    _optimize_sequential(
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 160, in _optimize_sequential
    frozen_trial_id = _run_trial(study, func, catch)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 258, in _run_trial
    raise func_err
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/optuna/study/_optimize.py", line 201, in _run_trial
    value_or_values = func(trial)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 196, in <lambda>
    study.optimize(lambda trial: objective(trial, loader=loader, run_dir=run_dir, max_epochs=max_epochs, patience=patience), n_trials=n_trials)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/run/run_optuna.py", line 166, in objective
    best_loss = diffusion.train(
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 185, in train
    self.plot_histogram(loader=dataloader, epoch=last_epoch, sample_info=sample_info, samples=samples)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/model/diffusion.py", line 218, in plot_histogram
    plot_histogram(real, generated, title, out_dir=self.hist_dir)
  File "/home/merlinho/testspace/DDPM_Inpainting/src/save/save_plot.py", line 315, in plot_histogram
    bins_edges = np.histogram_bin_edges(combined, bins=bins)  # e.g., bins=50
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/numpy/lib/histograms.py", line 669, in histogram_bin_edges
    bin_edges, _ = _get_bin_edges(a, bins, range, weights)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/numpy/lib/histograms.py", line 426, in _get_bin_edges
    first_edge, last_edge = _get_outer_edges(a, range)
  File "/home/merlinho/.conda/envs/diffusion_rain/lib/python3.10/site-packages/numpy/lib/histograms.py", line 323, in _get_outer_edges
    raise ValueError(
ValueError: autodetected range of [nan, nan] is not finite
